# Black Sam
## Why?
The Internet's pretty useful, but different agents are making it more and more difficult for people to access information: data and media censored by big corporations and governments for lots of reasons (many pretty ridiculous). Centralization of that makes it utterly simple to take down things, just take The Pirate Bay as the most recent example. Everyone thinks The Pirate Bay is just there to allow you to get the latest album of your favorite artist without paying, or that episode of that TV show your french friend told you about, but it isn't... _piracy_ is about freedom, taking by caring and sharing without caring.

There are torrents out there with valuable information about corrupt companies and governments, survival, advice, and a valuable way for indie photographers, directors, musicians and game developers to share and distribute their work. Why stop that from happening?

## What is it?
**BlackSam** is a _simple_ torrent search and upload software for **Node.js** (like that used on The Pirate Bay, Iso Hunt or similars) you can quickly get up and running in your computer, server or cloud service, _**without any database**_. This effectively allows to share, browse, edit and restore the entire "database" of torrents easily, just by pointing it to a server you'd like to mirror, or even just create your own community.

## How do I install it?
You can't. It's not ready yet.

## How does it work?
Where do we store all data? In the File System, obviously. All data is stored in a subdirectory where **BlackSam** in installed, which is named -you guessed it- ```marianne``` . Oh, you didn't guess it? That's the name of the first ship _Black Sam_ sailed as captain, and [a name for the goddess of freedom](http://en.wikipedia.org/wiki/Marianne). Pay attention.

### User management
When a user registers, a new directory is created inside the ```marianne``` directory with the name of the RIPEMD-160 hash generated by the SHA-256 hash of the SHA-512 hash of the username and password combined:

 ```
 ripemd(sha256(sha512(<username> + <password>)))
 ```

Because of the way **BlackSam** keeps all _Ships_ (or _nodes_ for non-pirate lads) in sync, users cannot _directly_ change their username or password (see Replication section for details). This means the user will login with a _username_ and _password_ combination that can still be anonymous, and is nearly impossible crack or guess. This also means that there is effectively no password reset available at all, and one is very likely to never be implemented.

However, a ```user.lock``` file containing the SHA-256 hash of the username and password combined (same as above, but leaving out SHA-256 and RIPEMD-160) can be created to make **BlackSam** ignore any new data for that user, "locking down" that account. A _pointer_ to the new account (user folder) can be stored too to be able to link two (or more) accounts as the same entity, but it can be skipped.

```
<sha256(username + password)>:<new account hash>
```

This mechanism allows **BlackSam** validate a _lock_ file, so adversaries cannot create a _Denial of Service_ on any user. A user can request a new username or password combination without worrying about misuse of a previous account, if for example their credentials where stolen somehow.

 If a user chooses to be displayed as the uploader of her torrents, **BlackSam** can create a _JSON_ file named ```user.json``` with "metadata" about her. Only ```displayName``` and ```email``` can be set inside that _JSON_ file, apart from the mandatory ```hash````field that must contain the SHA-256 of the SHA-512 hash of the username and password combined.

### Torrent storage
When a user uploads a _Torrent File_ or a _Magnet Link_, **BlackSam** creates 3 files inside the ```marianne/<uploader hash>``` directory. _Metafiles_'s hash (seen in by _Magnet Links_) are used as the filename for these 3 files.

#### {hash}.torrent
Before accepting a Torrent to be stored, it is checked to be a valid Torrent with at least 1 seeder. Torrents with no seeds are not stored, and Torrents that were accepted beofre are deleted if they've got no seeders when the cleanup is ran (which is ran, by default, once a week).

_Torrent Files_ are generated by a _Magnet Link_, and viceversa.

#### {hash}.md
**BlackSam** allows the use of [Markdown Files](https://github.com/evilstreak/markdown-js) to create descriptions for _Torrent Files_. During upload it can try to find ```README```, ```*.nfo```, ```*.md``` and ```README``` files inside the Torrent to auto-generate this description.

#### {hash}.json
For the purposes of the Search Indexing and metadata keeping, **BlackSam** creates a _JSON file_ with the Torrent's file location, title, description string (taken from the Makrdown stripped from any symbols and short words) and seed-leech counts.

### Search
[Search-index module](https://github.com/fergiemcdowall/search-index) is used to provide the search functionality. **BlackSam** feeds to it all the Torrent's _JSON Files_ described above. That's pretty much it.

An _Index Directory_ is created, named ```sultana``` (2nd ship where _Black Sam_ was captain), where the Search Index is to be stored.

### Replication
The most importart part of this whole thing, is accomplished by using [Telehash](https://github.com/telehash/telehash-js), a DHT implementation (similar to that used by BitTorrent protocol), and the BitTorrent protocol itself. **BlackSam** will distribute changes between all _Ships_ (or _node_ for non-pirate lad), making sure everyone is in sync. When new changes are available, all _Ships_ will receive the changes as a torrent.

As a rule of thumb, every _Ship_ is capable of _**adding new files**_ to other _Ships_ _**but not delete nor overwrite anything**_. **BlackSam** runs cleanup tasks that ensure that only working torrents exist in it's _database_, but deletions are not propagated to everyone; each node is responsible of deciding if a torrent should be removed. Thus, **BlackSam** users cannot delete any torrent they've added, nor change their user name, password, display-name or tripcode if they've picked one. Adversaries can attempt to join the network, but cannot alter it's functionality or availability.

Initial sync of a **BlackSam** node

## But...
Yeah, there's always _buts_. Here, hopefully you'll be satisfied with:

### ... why Black Sam?
Simple. **Samuel Bellamy**, known as **[Black Sam](http://en.wikipedia.org/wiki/Samuel_Bellamy)**, is considered the #1 top-earning pirate of all times according to [Forbes](http://www.forbes.com/2008/09/18/top-earning-pirates-biz-logistics-cx_mw_0919piracy.html), and also regarded by his crew as "The Robin Hood of the Seas". He's known to believe he wasn't harming anyone through his actions as a pirate, but rather as merely taking back what others had stolen through the exploitation of the people. And not only that, he was also known to held _very_ democratic (at least for his times) rules for his crew.

It just so happens that this project has (hopefully) those -and probably more- things in common with him.

### ... why Node.js?
There's already [Isohunt's OpenBay](https://github.com/isohuntto/openbay) effort to create something very similar to this, and it would probably be easier to use build upon that. However, using PHP might not be as simple for many users to use and setup locally as this project's trying to be. Not to mention that the possibility of a Node-Webkit application is very enticing.
